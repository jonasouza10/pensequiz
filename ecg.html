<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="PenseQuiz ECG M√©dica - Um quiz de Eletrocardiograma para estudantes e profissionais da sa√∫de.">
  <meta name="theme-color" content="#000000">
  <link rel="manifest" href="manifest.json">
  <title>PenseQuiz ECG</title>
  <style>
    /* Estilo geral do corpo da p√°gina - Tema Retro Terminal */
    body {
      margin: 0;
      background-color: #1a1a1a; /* Fundo escuro */
      color: #00ff00; /* Cor verde neon para o texto padr√£o */
      font-family: "Courier New", monospace; /* Fonte monoespa√ßada cl√°ssica */
      padding: 20px;
      overflow: hidden; /* Controla a rolagem no corpo da p√°gina */
      display: flex;
      flex-direction: column;
      height: 100vh;
      box-sizing: border-box;
      text-shadow: 0 0 3px #00ff00; /* Efeito de brilho no texto */
    }

    /* Estilo dos cabe√ßalhos e par√°grafos */
    h1, p {
      text-align: center;
      text-shadow: 0 0 8px #00ff00; /* Brilho mais intenso para t√≠tulos */
      margin-bottom: 5px;
    }

    p {
      font-size: 0.9em;
      margin-top: 0;
    }

    /* Estilo do terminal de exibi√ß√£o das mensagens */
    #terminal {
      white-space: pre-wrap;
      line-height: 1.5;
      height: 40vh; /* Altura ajustada para acomodar bot√µes extra */
      overflow-y: auto; /* Adiciona rolagem vertical se o conte√∫do exceder */
      margin-bottom: 10px;
      border: 2px solid #00ff00; /* Borda s√≥lida verde neon */
      padding: 15px;
      background-color: #0d0d0d; /* Fundo do terminal mais escuro */
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0, 255, 0, 0.5); /* Sombra externa para o brilho do terminal */
      scroll-behavior: smooth;
      position: relative; /* Para o cursor */
    }

    /* Estilo para cada entrada de log no terminal */
    .log-entry {
      margin-bottom: 8px; /* Espa√ßamento entre as linhas de log */
      padding: 2px 0;
      display: block; /* Garante que cada entrada ocupe sua pr√≥pria linha */
    }

    /* Cores espec√≠ficas para mensagens de alerta e diagn√≥stico */
    .log-entry.alerta {
        color: #FF0000; /* Vermelho vibrante para alertas */
        text-shadow: 0 0 5px #FF0000, 0 0 10px rgba(255, 0, 0, 0.7); /* Brilho vermelho */
        font-weight: bold;
    }

    .log-entry.diagnostico {
        color: #00BFFF; /* Azul profundo para diagn√≥stico */
        text-shadow: 0 0 5px #00BFFF, 0 0 10px rgba(0, 191, 255, 0.7); /* Brilho azul */
        font-weight: bold;
    }

    .log-entry.input_req { /* Nova cor para INPUT_REQ */
        color: gold; /* Gold */
        text-shadow: 0 0 5px gold, 0 0 10px rgba(255, 215, 0, 0.7);
        font-weight: bold;
    }

    /* Cursor piscante */
    .cursor {
      display: inline-block;
      width: 8px;
      height: 1.1em;
      background-color: #00ff00;
      animation: blink-caret 0.75s step-end infinite;
      vertical-align: text-bottom;
      margin-left: 2px;
    }

    @keyframes blink-caret {
      from, to { background-color: transparent }
      50% { background-color: #00ff00; }
    }

    /* Cont√™iner para os bot√µes de escolha */
    #choices {
      display: flex;
      flex-direction: row; /* Alterado para linha */
      flex-wrap: wrap; /* Permite que os itens quebrem para a pr√≥xima linha */
      justify-content: center; /* Centraliza os bot√µes na linha */
      gap: 10px; /* Espa√ßo entre os bot√µes */
      margin-top: 15px;
      height: 30vh; /* Altura ajustada para acomodar bot√µes extra */
      overflow-y: auto; /* Adiciona rolagem vertical se as escolhas excederem */
      align-items: flex-start; /* Alinha os itens ao topo */
    }

    /* Estilo dos bot√µes de alternativa */
    .choice {
      background: #333; /* Fundo escuro para os bot√µes */
      border: 1px solid #00ff00;
      color: #00ff00;
      font-family: inherit;
      padding: 12px;
      cursor: pointer;
      text-align: center; /* Centraliza o texto dentro do bot√£o */
      transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease;
      border-radius: 4px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.5); /* Sombra para efeito 3D */
      flex: 1 1 calc(50% - 10px); /* Ocupa 50% da largura menos o gap, permite encolher */
      max-width: calc(50% - 10px); /* Garante que n√£o exceda 50% */
    }

    /* Ajuste para telas menores para que os bot√µes fiquem em coluna novamente se necess√°rio */
    @media (max-width: 600px) {
        .choice {
            flex: 1 1 100%; /* Ocupa 100% da largura em telas pequenas */
            max-width: 100%;
        }
    }

    /* Efeito ao passar o mouse sobre os bot√µes */
    .choice:hover {
      background-color: #444; /* Fundo um pouco mais claro no hover */
      box-shadow: 0 0 10px #00ff00, 0 0 15px rgba(0, 255, 0, 0.3);
      transform: translateY(-2px); /* Pequeno levantamento */
    }

    /* Estilo para bot√µes desabilitados */
    .choice:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
        background-color: #222;
    }

    /* Cores de feedback para os bot√µes de escolha */
    .choice.selected { /* Cor quando o usu√°rio clica */
        background-color: #FFD700; /* Gold */
        color: #1a1a1a;
        box-shadow: 0 0 10px #FFD700;
    }

    .choice.correct { /* Cor da resposta correta */
        background-color: #39ff14; /* Verde sucesso */
        color: #1a1a1a;
        box-shadow: 0 0 10px #39ff14;
    }

    .choice.incorrect { /* Cor da resposta incorreta selecionada pelo usu√°rio */
        background-color: #ff3333; /* Vermelho falha */
        color: #1a1a1a;
        box-shadow: 0 0 10px #ff3333;
    }


    /* Estilo do placar de pontua√ß√£o */
    #placar {
      text-align: center;
      margin: 15px 0;
      font-size: 1.2em;
      font-weight: bold;
      text-shadow: 0 0 6px #00ff00;
      border: 1px dashed #00ff00;
      padding: 8px;
      border-radius: 5px;
      background-color: #0d0d0d;
    }

    /* Estilo do rodap√© */
    footer {
      text-align: center;
      font-size: 0.8em;
      margin-top: auto;
      padding-top: 15px;
      color: #99ff99; /* Cor mais suave para o rodap√© */
      text-shadow: none;
    }

    /* Cont√™iner para os bot√µes de controle (reiniciar, manual, refer√™ncia) */
    #control-buttons-container {
        display: flex; /* Usa flexbox para coloc√°-los lado a lado */
        justify-content: center; /* Centraliza os bot√µes no cont√™iner */
        gap: 15px; /* Espa√ßo entre os bot√µes */
        margin-top: 20px; /* Espa√ßamento acima */
    }

    /* Estilo dos bot√µes de controle */
    .control-button {
      padding: 10px 20px;
      background-color: #333;
      border: 2px solid #00ff00;
      color: #00ff00;
      font-family: inherit;
      cursor: pointer;
      font-size: 1em;
      box-shadow: 0 0 8px #00ff00, 0 0 15px rgba(0, 255, 0, 0.4);
      transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.1s ease;
      border-radius: 8px;
      text-transform: uppercase;
    }

    .control-button:hover {
      background-color: #555;
      box-shadow: 0 0 15px #00ff00, 0 0 25px rgba(0, 255, 0, 0.6) inset;
      transform: scale(1.02);
    }

    /* Estilo espec√≠fico para o bot√£o reiniciar (que aparece depois) */
    #reiniciar {
      display: none; /* Inicia oculto */
      margin-top: 20px; /* Separar um pouco dos outros */
      width: fit-content; /* Ajusta a largura ao conte√∫do */
    }

    /* Estilo do modal (manual e refer√™ncias) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgba(0,0,0,0.8); /* Black w/ opacity */
        padding-top: 60px;
    }

    .modal-content {
        background-color: #1a1a1a;
        margin: 5% auto; /* 15% from the top and centered */
        padding: 20px;
        border: 2px solid #00ff00;
        width: 80%; /* Could be more or less, depending on screen size */
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.7);
        color: #00ff00;
        text-shadow: 0 0 5px #00ff00;
        font-family: "Courier New", monospace;
        max-height: 80vh;
        overflow-y: auto;
    }

    .modal-content h2 {
        text-align: center;
        color: #00ff00;
        text-shadow: 0 0 10px #00ff00;
        margin-bottom: 20px;
    }

    .modal-content p, .modal-content ul {
        margin-bottom: 10px;
        line-height: 1.6;
    }

    .modal-content ul li {
        margin-left: 20px;
        list-style-type: '‚ö° '; /* Custom bullet point */
    }

    .close-button {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close-button:hover,
    .close-button:focus {
        color: #fff;
        text-decoration: none;
        cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>PenseQuiz Eletrocardiograma ECG) </h1>
  <p>Diagn√≥stico de Ritmos Card√≠acos para Especialistas Virtuais ‚ö°</p>

  <div id="terminal">[SISTEMA DE AN√ÅLISE CARD√çACA INICIADO] üîê</div>
  <div id="placar">‚úÖ Acertos: 0 | ‚ùå Erros: 0 | üëæ Anomalias restantes: 0</div>
  <div id="choices"></div>
  
  <div id="control-buttons-container">
    <button id="manualBtn" class="control-button" onclick="showManual()">üìö MANUAL DE DIAGN√ìSTICO</button>
    <button id="referencesBtn" class="control-button" onclick="showReferences()">üìë REFER√äNCIAS BIBLIOGR√ÅFICAS</button>
  </div>
  <button id="reiniciar" class="control-button" onclick="reiniciarQuiz()">üîÅ REINICIAR SISTEMA DE DIAGN√ìSTICO</button>

  <footer>
    ¬© 2025 PenseQuiz.com ‚Äî Todos os direitos reservados.<br>
    Contato: juniosilvasouza@yahoo.com.br | WhatsApp: (92) 98856-2216
  </footer>

  <div id="manualModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeModal('manualModal')">&times;</span>
      <h2>MANUAL DE DIAGN√ìSTICO ECG</h2>
      <p>Bem-vindo, Futuro Especialista em Eletrocardiograma! Este simulador foi desenvolvido para aprimorar suas habilidades de diagn√≥stico de anomalias card√≠acas atrav√©s de tra√ßados de ECG.</p>
      
      <h3>OBJETIVO DA MISS√ÉO:</h3>
      <ul>
        <li>Identificar corretamente as anomalias card√≠acas apresentadas no terminal.</li>
        <li>Selecionar o diagn√≥stico mais preciso entre as op√ß√µes dispon√≠veis.</li>
        <li>Aumentar seu conhecimento em eletrocardiografia.</li>
      </ul>

      <h3>COMO JOGAR:</h3>
      <ol>
        <li><strong>In√≠cio:</strong> O sistema iniciar√° a simula√ß√£o e apresentar√° uma "Anomalia Detectada" no terminal.</li>
        <li><strong>An√°lise:</strong> Leia a descri√ß√£o da anomalia e os crit√©rios ("SCAN") cuidadosamente.</li>
        <li><strong>Diagn√≥stico:</strong> Abaixo do terminal, voc√™ encontrar√° quatro op√ß√µes de diagn√≥stico. Clique na op√ß√£o que voc√™ considera a correta.</li>
        <li><strong>Feedback:</strong> O sistema informar√° se seu diagn√≥stico foi "BEM-SUCEDIDO" (correto) ou "FALHA" (incorreto). A alternativa correta ser√° destacada.</li>
        <li><strong>Progresso:</strong> O placar no topo da tela manter√° o controle de seus acertos, erros e o n√∫mero de anomalias restantes.</li>
        <li><strong>Finaliza√ß√£o:</strong> A simula√ß√£o terminar√° quando todas as anomalias tiverem sido processadas.</li>
      </ol>

      <h3>PONTUA√á√ÉO:</h3>
      <ul>
        <li>Cada diagn√≥stico correto aumenta seu contador de "Acertos".</li>
        <li>Cada diagn√≥stico incorreto aumenta seu contador de "Erros".</li>
      </ul>

      <p>Prepare-se para o desafio! A precis√£o √© vital neste campo. Boa sorte, Operador!</p>
    </div>
  </div>

  <div id="referencesModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeModal('referencesModal')">&times;</span>
      <h2>REFER√äNCIAS BIBLIOGR√ÅFICAS</h2>
      <p>As perguntas e respostas contidas neste PenseQuiz ECG M√©dica foram elaboradas com base em conhecimentos gerais de eletrocardiografia, com o objetivo de auxiliar no aprendizado e revis√£o.</p>
      <p>Para aprofundamento e estudo detalhado, recomenda-se consultar as seguintes fontes fidedignas da literatura m√©dica:</p>
      <ul>
        <li>**LIVRO:** Ferri's Clinical Advisor [Ano da Edi√ß√£o], Editora [Nome da Editora].</li>
        <li>**LIVRO:** Goldberger's Clinical Electrocardiography: A Simplified Approach [Ano da Edi√ß√£o], Editora [Nome da Editora].</li>
        <li>**DIRETRIZES:** Diretrizes de Cardiologia da Sociedade Brasileira de Cardiologia (SBC) ou American Heart Association (AHA) / American College of Cardiology (ACC).</li>
        <li>**ARTIGOS CIENT√çFICOS:** Artigos e revis√µes publicados em peri√≥dicos cient√≠ficos renomados na √°rea de cardiologia e eletrofisiologia.</li>
        <li>**RECURSOS ONLINE:** Plataformas de ensino m√©dico reconhecidas, como UpToDate, Medscape, e eMedicine, com foco em Eletrocardiografia.</li>
      </ul>
      <p>Lembre-se que este quiz √© uma ferramenta de estudo e n√£o substitui o julgamento cl√≠nico profissional ou a consulta a fontes prim√°rias de conhecimento.</p>
    </div>
  </div>

  <script>
    // Refer√™ncias aos elementos do DOM
    const terminal = document.getElementById("terminal");
    const choicesDiv = document.getElementById("choices");
    const placarDiv = document.getElementById("placar");
    const botaoReiniciar = document.getElementById("reiniciar");
    const manualModal = document.getElementById("manualModal");
    const referencesModal = document.getElementById("referencesModal");

    // Banco de dados de desafios (perguntas) original com perguntas de ECG
    // ATEN√á√ÉO: As perguntas foram duplicadas para atingir 200, mas s√£o repetitivas.
    // Voc√™ deve substituir estas perguntas por conte√∫do original e diversificado.
    const desafiosBase = [
      {
        "inimigo": "Onda P ausente",
        "correta": "Fibrila√ß√£o atrial",
        "texto": "A aus√™ncia da onda P indica atividade atrial desorganizada, caracter√≠stica da fibrila√ß√£o atrial.",
        "ameaca": "ONDA P INVIS√çVEL. CAUSA DESCONHECIDA. DIAGN√ìSTICO NECESS√ÅRIO.",
        "alternativas": ["Taquicardia sinusal", "Flutter atrial", "Fibrila√ß√£o atrial", "Bradicardia sinusal"]
      },
      {
        "inimigo": "Eleva√ß√£o do segmento ST",
        "correta": "Infarto agudo do mioc√°rdio",
        "texto": "A eleva√ß√£o persistente do segmento ST √© um forte indicativo de infarto agudo do mioc√°rdio, mostrando les√£o mioc√°rdica.",
        "ameaca": "SEGMENTO ST ELEVADO. POSS√çVEL ISQUEMIA GRAVE. A√á√ÉO IMEDIATA REQUERIDA.",
        "alternativas": ["Pericardite", "Infarto agudo do mioc√°rdio", "Angina inst√°vel", "Repolariza√ß√£o precoce"]
      },
      {
        "inimigo": "Complexo QRS largo",
        "correta": "Bloqueio de ramo",
        "texto": "Um complexo QRS com dura√ß√£o maior que 0.12 segundos (120ms) geralmente aponta para um bloqueio de ramo ou outro dist√∫rbio de condu√ß√£o ventricular.",
        "ameaca": "QRS ALARGADO. CONDU√á√ÉO ANORMAL NO VENTR√çCULO. IDENTIFIQUE A ORIGEM.",
        "alternativas": ["Taquicardia supraventricular", "Flutter atrial", "Bloqueio de ramo", "Bradicardia sinusal"]
      },
      {
        "inimigo": "Intervalo PR prolongado",
        "correta": "Bloqueio atrioventricular de 1¬∫ grau",
        "texto": "Um intervalo PR maior que 0.20 segundos (200ms) indica um atraso na condu√ß√£o do impulso do √°trio para o ventr√≠culo, caracterizando um bloqueio atrioventricular de 1¬∫ grau.",
        "ameaca": "PR AL√âM DO LIMITE. VERIFIQUE A CONDU√á√ÉO AV.",
        "alternativas": ["Bloqueio atrioventricular de 1¬∫ grau", "Bloqueio atrioventricular de 2¬∫ grau", "Fibrila√ß√£o atrial", "Taquicardia juncional"]
      },
      {
        "inimigo": "Onda T invertida sim√©trica",
        "correta": "Isquemia mioc√°rdica",
        "texto": "Ondas T invertidas e sim√©tricas, especialmente em m√∫ltiplas deriva√ß√µes, s√£o sugestivas de isquemia mioc√°rdica subepic√°rdica.",
        "ameaca": "ONDA T INVERTIDA. FLUXO SANGU√çNEO COMPROMETIDO. AVALIE A ISQUEMIA.",
        "alternativas": ["Pericardite", "Hipercalemia", "Isquemia mioc√°rdica", "Repolariza√ß√£o precoce"]
      },
      {
        "inimigo": "Ritmo irregularmente irregular sem onda P definida",
        "correta": "Fibrila√ß√£o atrial",
        "texto": "A fibrila√ß√£o atrial √© caracterizada por um ritmo ventricular irregular (irregularmente irregular) e aus√™ncia de ondas P organizadas, substitu√≠das por ondas f (fibrilat√≥rias).",
        "ameaca": "ATIVIDADE CA√ìTICA: RITMO IRREGULAR, SEM ONDA P. IDENTIFIQUE A ARITMIA.",
        "alternativas": ["Flutter atrial", "Fibrila√ß√£o atrial", "Taquicardia sinusal", "Extras√≠stoles atriais"]
      },
      {
        "inimigo": "Ondas em 'serrilhado' (sawtooth waves) em DII, DIII, aVF",
        "correta": "Flutter atrial",
        "texto": "O flutter atrial √© reconhecido pelas ondas F (flutter) em 'serrilhado' na linha de base, geralmente mais vis√≠veis em deriva√ß√µes inferiores.",
        "ameaca": "PADR√ÉO ESTRANHO: ONDAS EM SERRILHADO NO ECG. CLASSIFIQUE A ARITMIA ATRIAL.",
        "alternativas": ["Fibrila√ß√£o atrial", "Flutter atrial", "Taquicardia atrial multifocal", "Taquicardia sinusal"]
      },
      {
        "inimigo": "Onda U proeminente",
        "correta": "Hipocalemia",
        "texto": "A presen√ßa de uma onda U proeminente, especialmente ap√≥s a onda T, pode ser um sinal de hipocalemia (n√≠veis baixos de pot√°ssio no sangue).",
        "ameaca": "ONDAS INESPERADAS: ONDA U PROEMINENTE. DESEQUIL√çBRIO ELETROL√çTICO SUSPEITO.",
        "alternativas": ["Hipercalemia", "Hipocalemia", "Isquemia mioc√°rdica", "Efeitos da digoxina"]
      },
      {
        "inimigo": "Onda T alta e apiculada (tented)",
        "correta": "Hipercalemia",
        "texto": "A hipercalemia (n√≠veis altos de pot√°ssio no sangue) pode causar ondas T altas, sim√©tricas e com base estreita, conhecidas como 'tented T waves'.",
        "ameaca": "ONDA T PICUDA. N√çVEIS ELETROL√çTICOS ANORMAIS. CORRIJA O DESEQUIL√çBRIO.",
        "alternativas": ["Hipocalemia", "Hipercalemia", "Isquemia mioc√°rdica", "Miocardite"]
      },
      {
        "inimigo": "Ritmo sinusal com frequ√™ncia acima de 100 bpm",
        "correta": "Taquicardia sinusal",
        "texto": "A taquicardia sinusal √© um ritmo card√≠aco normal, mas com frequ√™ncia acima de 100 batimentos por minuto (bpm), geralmente em resposta a estresse, exerc√≠cio ou febre.",
        "ameaca": "ACELERA√á√ÉO CARD√çACA: RITMO REGULAR E R√ÅPIDO. IDENTIFIQUE A CAUSA SINUSAL.",
        "alternativas": ["Taquicardia supraventricular", "Taquicardia ventricular", "Taquicardia sinusal", "Flutter atrial"]
      },
      {
        "inimigo": "Aus√™ncia completa de atividade el√©trica organizada",
        "correta": "Assistolia",
        "texto": "A assistolia √© a aus√™ncia total de atividade el√©trica ventricular, resultando em aus√™ncia de contra√ß√£o card√≠aca e parada card√≠aca.",
        "ameaca": "SISTEMA INATIVO: AUS√äNCIA TOTAL DE SINAL. DIAGN√ìSTICO CR√çTICO.",
        "alternativas": ["Fibrila√ß√£o ventricular", "Atividade el√©trica sem pulso", "Assistolia", "Bradicardia extrema"]
      },
      {
        "inimigo": "Segmento ST deprimido",
        "correta": "Isquemia subendoc√°rdica",
        "texto": "A depress√£o do segmento ST √© um sinal de isquemia mioc√°rdica, frequentemente subendoc√°rdica, indicando falta de oxig√™nio no m√∫sculo card√≠aco.",
        "ameaca": "DEPRESS√ÉO DETECTADA: SEGMENTO ST ABAIXO DA LINHA DE BASE. IND√çCIO DE ISQUEMIA.",
        "alternativas": ["Infarto transmural", "Pericardite", "Isquemia subendoc√°rdica", "Hipertrofia ventricular"]
      },
      {
        "inimigo": "Onda Q patol√≥gica",
        "correta": "Infarto pr√©vio",
        "texto": "Uma onda Q patol√≥gica (larga e/ou profunda) √© um marcador de infarto mioc√°rdico pr√©vio, indicando necrose do tecido card√≠aco.",
        "ameaca": "REGISTRO HIST√ìRICO: ONDA Q ANORMAL. AVALIE LES√ÉO MIOC√ÅRDICA ANTIGA.",
        "alternativas": ["Isquemia aguda", "Miocardite", "Infarto pr√©vio", "Variante normal"]
      },
      {
        "inimigo": "Complexo QRS estreito com frequ√™ncia elevada e sem onda P vis√≠vel",
        "correta": "Taquicardia supraventricular (TSV)",
        "texto": "Uma taquicardia com QRS estreito e sem onda P discern√≠vel geralmente sugere uma origem supraventricular, como a Taquicardia por Reentrada Nodal.",
        "ameaca": "SINAL R√ÅPIDO E ESTREITO: QRS R√ÅPIDO, P AUSENTE. ORIGEM SUPRAVENTRICULAR?",
        "alternativas": ["Taquicardia ventricular", "Fibrila√ß√£o atrial", "Taquicardia supraventricular (TSV)", "Flutter atrial"]
      },
      {
        "inimigo": "Padr√£o S1Q3T3",
        "correta": "Embolia pulmonar",
        "texto": "O padr√£o S1Q3T3 (onda S em D1, onda Q em D3, onda T invertida em D3) √© um achado cl√°ssico, embora inespec√≠fico, de embolia pulmonar aguda.",
        "ameaca": "ASSINATURA ANORMAL: PADR√ÉO S1Q3T3. BUSQUE POR EMBOLIA.",
        "alternativas": ["Infarto inferior", "Pericardite", "Embolia pulmonar", "Bloqueio de ramo esquerdo"]
      },
      {
        "inimigo": "Depress√£o do segmento PR",
        "correta": "Pericardite",
        "texto": "A depress√£o do segmento PR √© um achado comum na pericardite aguda, devido √† inflama√ß√£o atrial.",
        "ameaca": "DEPRESS√ÉO NA LINHA DE BASE: SEGMENTO PR ABAIXO DA ISOEL√âTRICA. VERIFIQUE INFLAMA√á√ÉO.",
        "alternativas": ["Infarto agudo do mioc√°rdio", "Pericardite", "Miocardite", "Endocardite"]
      },
      {
        "inimigo": "Onda T bif√°sica ou invertida em V2-V3 com QRS normal",
        "correta": "S√≠ndrome de Wellens",
        "texto": "A S√≠ndrome de Wellens √© caracterizada por ondas T bif√°sicas ou invertidas em V2-V3, indicando estenose cr√≠tica da art√©ria descendente anterior esquerda, mesmo na aus√™ncia de eleva√ß√£o do ST.",
        "ameaca": "ONDA T EM V2-V3 BIF√ÅSICA/INVERTIDA. PERIGO PR√ìXIMO.",
        "alternativas": ["Infarto anterior", "S√≠ndrome de Wellens", "Pericardite", "Hipertrofia ventricular esquerda"]
      },
      {
        "inimigo": "Altern√¢ncia el√©trica (altern√¢ncia de voltagem QRS)",
        "correta": "Tamponamento card√≠aco",
        "texto": "A altern√¢ncia el√©trica (varia√ß√µes de QRS batimento a batimento) √© um sinal de tamponamento card√≠aco, causada pela movimenta√ß√£o oscilat√≥ria do cora√ß√£o dentro do l√≠quido peric√°rdico.",
        "ameaca": "VARIA√á√ÉO DE SINAL: ALTERN√ÇNCIA DE VOLTAGEM QRS. BUSQUE AC√öMULO DE L√çQUIDO.",
        "alternativas": ["Fibrila√ß√£o ventricular", "Flutter atrial", "Tamponamento card√≠aco", "Insufici√™ncia card√≠aca"]
      },
      {
        "inimigo": "Onda delta (pr√©-excita√ß√£o)",
        "correta": "S√≠ndrome de Wolff-Parkinson-White (WPW)",
        "texto": "A onda delta √© uma inclina√ß√£o lenta inicial no complexo QRS, resultado da pr√©-excita√ß√£o ventricular atrav√©s de uma via acess√≥ria, t√≠pica da S√≠ndrome de Wolff-Parkinson-White.",
        "ameaca": "ANOMALIA DE CONDU√á√ÉO: ONDA DELTA NO QRS. IDENTIFIQUE VIA ACESS√ìRIA.",
        "alternativas": ["Bloqueio de ramo", "S√≠ndrome de Wolff-Parkinson-White (WPW)", "Flutter atrial", "Taquicardia juncional"]
      },
      {
        "inimigo": "Ritmo ventricular lento com QRS largo e sem onda P",
        "correta": "Ritmo idioventricular",
        "texto": "O ritmo idioventricular √© um ritmo de escape, originado nos ventr√≠culos, caracterizado por frequ√™ncia lenta (20-40 bpm) e complexos QRS largos, na aus√™ncia de impulsos supraventriculares.",
        "ameaca": "CONTROLE COMPROMETIDO: RITMO LENTO, QRS ALARGADO. ORIGEM VENTRICULAR?",
        "alternativas": ["Bradicardia sinusal", "Ritmo juncional", "Ritmo idioventricular", "Bloqueio AV total"]
      }
    ];

    // Duplica as perguntas base at√© atingir 200 (ou mais, se as perguntas base j√° forem muitas)
    const desafiosOriginais = [];
    while (desafiosOriginais.length < 200) {
        desafiosOriginais.push(...desafiosBase);
    }
    // Corta o array para exatamente 200, se necess√°rio
    desafiosOriginais.splice(200);


    // Vari√°veis de estado do jogo
    let desafios = [];
    let index = 0;
    let acertos = 0;
    let erros = 0;
    let maxAmeacas = 0;
    let isTyping = false; // Flag para controlar o efeito de digita√ß√£o

    // Fun√ß√£o para atualizar o placar na tela
    function atualizarPlacar() {
      const restantes = Math.max(0, maxAmeacas - index);
      placarDiv.textContent = `‚úÖ ACERTOS: ${acertos} | ‚ùå ERROS: ${erros} | üëæ ANOMALIAS RESTANTES: ${restantes}`;
    }

    // Fun√ß√£o para simular o efeito de digita√ß√£o no terminal
    function typeWriterEffect(element, text, speed = 30) {
      return new Promise(resolve => {
        let i = 0;
        element.textContent = ''; // Limpa o conte√∫do antes de digitar
        const cursorSpan = document.createElement('span');
        cursorSpan.classList.add('cursor');
        element.appendChild(cursorSpan); // Adiciona o cursor

        function type() {
          if (i < text.length) {
            element.textContent = text.substring(0, i + 1);
            element.appendChild(cursorSpan); // Garante que o cursor esteja sempre no final
            i++;
            setTimeout(type, speed);
          } else {
            cursorSpan.remove(); // Remove o cursor ao finalizar a digita√ß√£o
            resolve();
          }
        }
        type();
      });
    }

    // Fun√ß√£o para imprimir texto no terminal com efeito de digita√ß√£o
    async function printTerminal(text, type = 'normal') {
        isTyping = true;
        const entry = document.createElement('div');
        entry.classList.add('log-entry');

        let color = '#00ff00'; // Cor padr√£o verde neon
        let bold = false;
        let prefix = '[SISTEMA]: ';

        if (type === 'alerta') {
            entry.classList.add('alerta');
            prefix = '[ALERTA DE DIAGN√ìSTICO] ANOMALIA DETECTADA: ';
        } else if (type === 'diagnostico') {
            entry.classList.add('diagnostico');
            prefix = '[DIAGN√ìSTICO]: ';
        } else if (type === 'sucesso') {
            color = '#39ff14'; // Verde sucesso
            bold = true;
            prefix = '‚úÖ [STATUS: SUCESSO]: ';
        } else if (type === 'falha') {
            color = '#ff3333'; // Vermelho falha
            bold = true;
            prefix = '‚ùå [STATUS: FALHA]: ';
        } else if (type === 'input_req') {
            entry.classList.add('input_req'); // Adiciona a classe para mudar a cor via CSS
            prefix = '[INPUT_REQ]: ';
        } else if (type === 'cmd_input') {
            color = '#00ffff'; // Ciano
            prefix = '[CMD_INPUT]: ';
        } else if (type === 'log_data') {
            color = '#a0a0a0'; // Cinza
            prefix = '[LOG_DATA]: ';
        } else if (type === 'final_message') {
            color = '#00ff00'; // Verde neon para mensagem final
            bold = true;
            prefix = ''; // Sem prefixo para a mensagem final
        } else if (type === 'criterio') {
            color = '#ffd700'; // Amarelo
            prefix = '[SCAN]: ';
        }


        entry.style.color = color; // Esta linha pode ser redundante se a classe CSS j√° definir a cor
        if (bold) {
            entry.style.fontWeight = 'bold';
        }
        terminal.appendChild(entry);
        await typeWriterEffect(entry, `${prefix}${text}`);
        terminal.scrollTop = terminal.scrollHeight;
        isTyping = false;
    }

    // Fun√ß√£o para exibir um novo desafio
    async function novoDesafio() {
      choicesDiv.innerHTML = ""; // Limpa as escolhas anteriores
      if (index >= desafios.length) {
        finalizarQuiz();
        return;
      }
      const desafio = desafios[index];
      await printTerminal(`${desafio.inimigo} üö®`, 'alerta');
      await printTerminal(desafio.ameaca, 'criterio');
      await printTerminal("SELECIONE O DIAGN√ìSTICO CORRETO.", 'input_req');

      // Embaralha as alternativas para cada pergunta
      const alternativasEmbaralhadas = shuffle([...desafio.alternativas]);

      // Adiciona os bot√µes de escolha AP√ìS as mensagens do terminal
      alternativasEmbaralhadas.forEach((alt) => {
        const btn = document.createElement("button");
        btn.classList.add("choice");
        btn.textContent = alt;
        btn.onclick = () => verificarResposta(alt, btn); // Passa o bot√£o clicado
        choicesDiv.appendChild(btn);
      });

      atualizarPlacar();
    }

    // Fun√ß√£o para verificar a resposta do jogador
    async function verificarResposta(resposta, clickedButton) {
      // Desabilita todos os bot√µes e aplica estilo "selected" ao clicado
      const buttons = choicesDiv.getElementsByTagName('button');
      for(let btn of buttons) {
        btn.disabled = true;
        btn.style.cursor = 'not-allowed';
      }
      clickedButton.classList.add('selected'); // Adiciona classe para feedback de sele√ß√£o

      const desafioAtual = desafios[index];
      await printTerminal(`EXECUTANDO AN√ÅLISE PARA '${resposta}'...`, 'cmd_input');

      if (resposta === desafioAtual.correta) {
        await printTerminal('DIAGN√ìSTICO BEM-SUCEDIDO! ANOMALIA CLASSIFICADA.', 'sucesso');
        await printTerminal(desafioAtual.texto, 'log_data');
        acertos++;
        clickedButton.classList.remove('selected'); // Remove selected
        clickedButton.classList.add('correct'); // Adiciona correct
      } else {
        await printTerminal('DIAGN√ìSTICO INCORRETO. ERRO NA CLASSIFICA√á√ÉO.', 'falha');
        await printTerminal(`Anomalia '${desafioAtual.inimigo}' persiste. RECALIBRANDO SISTEMA...`, 'diagnostico');
        erros++;
        clickedButton.classList.remove('selected'); // Remove selected
        clickedButton.classList.add('incorrect'); // Adiciona incorrect

        // Encontra e destaca a resposta correta
        for(let btn of buttons) {
            if (btn.textContent === desafioAtual.correta) {
                btn.classList.add('correct');
            }
        }
      }

      index++;
      atualizarPlacar(); // Atualiza o placar imediatamente
      setTimeout(async () => {
        if (index < desafios.length) {
          await novoDesafio();
        } else {
          await finalizarQuiz();
        }
      }, 2000); // Tempo de espera ap√≥s a resposta antes da pr√≥xima a√ß√£o
    }
    
    // Fun√ß√£o para finalizar o quiz e exibir o resultado
    async function finalizarQuiz() {
      choicesDiv.innerHTML = "";
      await printTerminal("RELAT√ìRIO DE SIMULA√á√ÉO CONCLU√çDO.", 'normal');
      const finalMessage = `Fim dos diagn√≥sticos! Voc√™ acertou ${acertos} de ${maxAmeacas} anomalias.`;
      await printTerminal(finalMessage, 'final_message');
      botaoReiniciar.style.display = "block";
    }

    // Fun√ß√£o para reiniciar o quiz
    async function reiniciarQuiz() {
      index = 0;
      acertos = 0;
      erros = 0;
      terminal.innerHTML = ""; // Limpa o terminal completamente
      await printTerminal("SISTEMA DE AN√ÅLISE CARD√çACA INICIADO", 'alerta');
      botaoReiniciar.style.display = "none";
      desafios = shuffle([...desafiosOriginais]);
      maxAmeacas = desafios.length; // Atualiza o total de anomalias
      setTimeout(async () => {
        await novoDesafio();
      }, 1000); // Tempo de espera antes do primeiro desafio
    }

    // Fun√ß√£o para embaralhar um array (algoritmo de Fisher-Yates)
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Fun√ß√µes para abrir e fechar modais
    function showManual() {
      manualModal.style.display = "block";
    }

    function showReferences() {
      referencesModal.style.display = "block";
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = "none";
    }

    // Fechar modal clicando fora dele
    window.onclick = function(event) {
      if (event.target == manualModal) {
        manualModal.style.display = "none";
      }
      if (event.target == referencesModal) {
        referencesModal.style.display = "none";
      }
    }

    // Inicia o quiz ao carregar a p√°gina
    window.onload = () => {
      // O c√≥digo de registro do Service Worker foi removido para evitar o erro de protocolo.
      // Se voc√™ deseja as funcionalidades de PWA, certifique-se de que o ambiente de execu√ß√£o
      // suporte o registro de Service Workers e reative o c√≥digo abaixo:
      /*
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js')
          .then(registration => {
            console.log('Service Worker registrado com sucesso:', registration);
          })
          .catch(error => {
            console.error('Falha ao registrar o Service Worker:', error);
          });
      }
      */
      reiniciarQuiz();
    };
  </script>
</body>
</html>